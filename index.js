"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function initMap(){console.log("--init route--");var e=config$1.getConfig(),r=e.controllerDir,o=e.controllerSuffix,t=new RegExp("([a-zA-Z0-9_]+)"+o+".js");console.assert(fs.existsSync(r),"controller filepath may need to be set, default:"+r),fs.readdirSync(r).forEach(function(e){var o=e.match(t);if(o){console.log(e);var n=require(path.resolve(r,e));controllerMap.set(o[1].toLocaleLowerCase(),new n)}})}function Router(e,r,o){controllerMap.size||initMap();var t=e.path.slice(1)||"index";if(/^\d+$/.test(t))return o();var n=t.split("/"),i=toArray(n),s=i[0],a=void 0===s?"index":s,f=i[1],l=void 0===f?"index":f,c=i.slice(2),u=controllerMap.get(a);if(!u)return o();u.ctx=e.app,u.req=e,u.res=r,u.next=o;var p=u[l];if(!p)return o();var g=u.__before,d=u.__after,v=Promise.resolve();g&&(v=Promise.resolve(g.apply(u))),v.then(function(e){return!1!==e&&p.apply(u,c)}).then(function(e){return!1!==e&&(d&&d.apply(u),e)})}Object.defineProperty(exports,"__esModule",{value:!0});var fs=_interopDefault(require("fs")),path=_interopDefault(require("path")),process=require("process"),config={controllerDir:path.resolve(process.cwd(),"src/controller"),controllerSuffix:"Controller"},config$1={setConfig:function(e){Object.assign(config,e)},getConfig:function(){return config}},toArray=function(e){return Array.isArray(e)?e:Array.from(e)},controllerMap=new Map,setConfig=config$1.setConfig;exports.Router=Router,exports.setConfig=setConfig;
